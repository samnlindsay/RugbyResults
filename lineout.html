<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>Rugby Lineouts</title>
    <style>
        body,
        html {
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
        }

        .title {
            font-size: 48px;
            font-weight: bold;
            text-align: left;
            padding: 10px;
            color: #03c;
        }

        .selections {
            background-color: #ccddff;
            padding: 10px;
            z-index: 1;
            font: 16px sans-serif;
            height: auto;
        }

        .button-title {
            font-size: 24px;
            text-align: center;
            font-weight: bold;
            padding: 5px;
        }

        .button-text {
            font-size: 12px;
            font-weight: lighter;
            padding-bottom: 10px;
        }

        .tablinks {
            width: 100%;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 3px;
            background-color: #03c2;
            border: 2px solid #111;
            color: #111;
            font-size: 20px;
            border-radius: 6px; 
        }

        .active {
            background-color: #03c;
            color: white;
            font-weight: bold;
        }

        #Hot.active {
            background-color: red;
        }

        #Flyby.active,
        #Crusaders.active {
            background-color: orange
        }

        #Transfer.active,
        #Cold.active {
            background-color: blue;
        }

        .button-group {
            border: 2px solid #111;
            background-color: #fff;
            display: inline-block;
            vertical-align: top;
            width: 150px;
            padding: 10px;
            padding-top: 0px;
            border-radius: 10px;
        }

        .text-box {
            /* border: 2px solid #111; */
            background-color: #fff;
            vertical-align: top;
            display: inline-block;
            text-align: center;
            width: 500px;
            /* padding: 30px; */
            margin-left: 50px;
            margin-top: 50px;
            padding: 30px;
            border-radius: 20px;
            font-weight: bold;
            font-style: italic;
            font-size: 60pt;
            color: #03c
        }   

        /* Add style options for disabled button */
        .tablinks:disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }

        input[type="checkbox"] {
            vertical-align: middle;
            position: relative;
            bottom: 2px;
            width: 20px;
            height: 20px;
            accent-color: #03c;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        .chart-container {
            padding: 10px;
            border: 2px solid #111;
            background-color: #fff;
            margin: 10px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="selections">
        <div class="title">EGRFC - Lineout Builder</div>
        <div style="display: inline-block;">
        <div class="button-group">
            <div class="button-title">Numbers</div>
            <div class="button-text">Number of players in the lineout</div>
            <button class="tablinks" style="width: 70px" onclick="select('n', this, '4'); select('receiver', this, '')">4</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '4'); select('receiver', this, '+1')">4+1</button>
            <button class="tablinks" style="width: 70px" onclick="select('n', this, '5'); select('receiver', this, '')">5</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '5'); select('receiver', this, '+1')">5+1</button>
            <button class="tablinks" style="width: 70px" onclick="select('n', this, '6'); select('receiver', this, '')">6</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '6'); select('receiver', this, '+1')">6+1</button>
            <button class="tablinks" onclick="select('n', this, '7'); select('receiver', this, '9')">7</button>
        </div>
        <label for="receiver" style="text-align: right; padding-right: 20px;">
            <div class="button-text">Receiver?<input type="checkbox" id="receiver_yn" name="receiver_yn" checked /></div>
            <script>
                var n = null;
                var setup = null;
                // Add event listener to the checkbox
                var receiverCheckbox = document.getElementById("receiver_yn");
                receiverCheckbox.addEventListener("change", function () {
                    select('receiver_yn', this, this.checked ? 'Y' : 'N');
                });
            </script>
        </label>
        </div>

        <div class="button-group">
            <div class="button-title">Setup</div>
            <div class="button-text">
                How we line up to show the defence a different picture
            </div>
            <button class="tablinks" onclick="select('setup', this, 'A')">Auckland</button>
            <button class="tablinks" onclick="select('setup', this, 'C')">Canterbury</button>
            <button class="tablinks" onclick="select('setup', this, 'H')">Highlanders</button>
            <button class="tablinks" onclick="select('setup', this, 'W')">Waikato</button>
        </div>
        <div class="button-group" style="width: 150px">
            <div class="button-title">Target</div>
            <div class="button-text">Where we intend to jump: Front, middle, or back</div>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '1')">1<br><span style="font-weight: lighter; font-size: small;">back</span></button>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '2')">2<br><span style="font-weight: lighter; font-size: small;">front</span></button>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '3')">3<br><span style="font-weight: lighter; font-size: small;">middle</span></button>
        </div>
        <div class="button-group" style="width: 180px">
            <div class="button-title">Play</div>
            <div class="button-text">First phase: Off the top (Hot), maul (Cold) or hybrid options</div>
            <button class="tablinks" id="Hot" onclick="select('play', this, 'Hot')">Hot</button><br />
            <button class="tablinks" id="Flyby" onclick="select('play', this, 'Flyby')">Flyby</button><br />
            <button class="tablinks" id="Crusaders" onclick="select('play', this, 'Crusaders')">Crusaders</button>
            <button class="tablinks" id="Transfer" onclick="select('play', this, 'Transfer')">Transfer</button>
            <button class="tablinks" id="Cold" onclick="select('play', this, 'Cold')">Cold</button>
        </div>
        <span id="fullCallText"></span>
    </div>


    <div class="container" style="width: 100%; display: flex; justify-content: left">
        <div class="chart-container">
            <h2 style="text-align: center">Setup</h2>
            <!-- Add accompanying text, dependent on which setup is selected -->
            <p id="setup-text"></p>

            <div id="setup-chart"></div>
        </div>
        <div class="chart-container">
            <h2 style="text-align: center">Throw</h2>
            <div id="throw-chart"></div>
        </div>
        <div class="chart-container">
            <h2 style="text-align: center">Play</h2>
            <div id="play-chart"></div>
        </div>
    </div>

    <script>
        var n = null;
        var setup = null;
        var call = null;
        var receiver = "";
        var receiver_yn = "Y";
        var play = null;

        function select(type, element, value) {
            // Remove active class from all buttons of the same type
            var buttons = element.parentNode.querySelectorAll(".tablinks");
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove("active");
            }

            // Add active class to the clicked button
            element.classList.add("active");

            // Update the corresponding variable
            if (type === "n") {
                n = value;
            } else if (type === "setup") {
                setup = value;
            } else if (type === "call") {
                call = value;
            } else if (type === "receiver") {
                receiver = value;
            } else if (type === "receiver_yn") {
                receiver_yn = value;
            } else if (type === "play") {
                play = value;
            }

            // Update the setup text
            var setupText = document.getElementById("setup-text");

            if (setup === "A") {
                text =
                    "<p><b>Auckland</b> has no walk-in pod to initiate the lineout, and no obvious target, with everyone facing the defence.</p><p>The first movement is the dummy jumper (D) attempting to commit the defensive front pod.</p>";
                if (n === "5") {
                    text +=
                        "<p>The dummy jumper has to rejoin the line to be front lifter (A1/A3). The back jumper either jumps (A1/A3) or lifts (A2).</p>";
                } else if (n === "6") {
                    text +=
                        "<p>The dummy jumper has to rejoin the line to be front lifter (A3). The middle jumper may have to either front lift (A1), back lift (A2) or jump (A3).</p>";
                } else if (n === "7") {
                    text +=
                        "<p>The dummy jumper has to rejoin the line to be front lifter (A3), or else can go wherever is necessary.</p>";
                }
                setupText.innerHTML = text;
            } else if (setup === "C") {
                text =
                    "<p><b>Canterbury</b> has a pod of 3 walking in, showing the defence a potential quick option to the middle.</p><p>As the pod reaches the line, it splits rapidly to join pods at the front and back.</p>";
                if (n === "5") {
                    text +=
                        "<p>The middle jumper follows whoever needs lifting (C1/C2), or else dummy lifts at the front before retreating (C3).</p>";
                } else if (n === "6") {
                    text +=
                        "<p>The walk-in pod leaves a large space in the middle to form complete pods at front (C2) and back (C1).</p>";
                } else if (n === "7") {
                    text +=
                        "<p>The middle jumper is free to hold the middle (C3), or else go wherever is necessary.</p>";
                }
                setupText.innerHTML = text;
            } else if (setup === "H") {
                text =
                    "<p><b>Highlanders</b> gives nothing away to the defence, everyone but the pillars walking in evenly spaced.</p><p>As soon as the hooker is ready, everyone runs into the line and immediately puts up the pre-called jumper.</p>";
            } else if (setup === "W") {
                text = "<p><b>Waikato</b> leaves multiple gaps in the line for potential jumpers to walk into, without any pre-formed pods.</p><p>This makes it easy to adjust positions and change the picture for the defence.</p>";
                if (n === "5") {
                    text += "<p>Two jumpers walk into two separate positions in the line (W1/W2), or they both lift in the middle (W3).</p>";
                } else if (n === "6") {
                    text += "<p>The three walk-in players can start as a pod, or in any configuration they like.</p>";
                } else if (n === "7") {
                    text += "<p>3 jumpers walk into 3 positions in the line - the defence cannot mark all 3.</p>";
                }
            }
            setupText.innerHTML = text;

            // When the receiver checkbox is checked, disable the 4+1, 5+1 and 6+1 buttons
            var fourPlusOneButton = document.querySelector(
                ".tablinks[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]"
            );
            var fivePlusOneButton = document.querySelector(
                ".tablinks[onclick=\"select('n', this, '5'); select('receiver', this, '+1')\"]"
            );
            var sixPlusOneButton = document.querySelector(
                ".tablinks[onclick=\"select('n', this, '6'); select('receiver', this, '+1')\"]"
            );
            if (receiver_yn === "N") {
                fourPlusOneButton.disabled = true;
                fivePlusOneButton.disabled = true;
                sixPlusOneButton.disabled = true;
                fourPlusOneButton.classList.remove('active');
                fivePlusOneButton.classList.remove('active');
                sixPlusOneButton.classList.remove('active');

                // If n has been selected, and it is 4, 5 or 6, and receiver is +1, change receiver to '' and set the n button to active
                if (n === '4' || n === '5' || n === '6') {
                    var nButton = document.querySelector(
                        ".tablinks[onclick=\"select('n', this, '" + n + "'); select('receiver', this, '')\"]"
                    );
                    nButton.classList.add('active');
                }

            } else {
                fourPlusOneButton.disabled = false;
                fivePlusOneButton.disabled = false;
                sixPlusOneButton.disabled = false;
            }


            // // If n === 4, disable the None receiver button, all Setup buttons and Flyby and Crusaders buttons (and remove active class from them)
            var setupButtons = document.querySelectorAll('.tablinks[onclick^="select(\'setup\', this"]');
            var targetButtons = document.querySelectorAll('.tablinks[onclick^="select(\'call\', this"]');

            // Text describing the full call
            if (n !== null && setup !== null && call !== null) {
                var numbers = n + (receiver === '+1' ? receiver : '-man');
                var fullcall = setup + call;
                document.getElementById("fullCallText").innerHTML = '<div class="text-box">\"' + numbers + ' ' + fullcall + '\"</div>';
            } else {
                document.getElementById("fullCallText").innerHTML = '';
            }

            // Check if both n and setup have been selected
            if (n !== null && setup !== null) {
                var spec1 =
                    "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/setup_" +
                    n +
                    receiver +
                    "_" +
                    setup +
                    ".json";
                vegaEmbed("#setup-chart", spec1, { actions: false }).catch(
                    console.error
                );

                if (call !== null) {
                    var spec2 =
                        "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/throw_" +
                        n +
                        receiver +
                        "_" +
                        setup +
                        call +
                        ".json";
                    vegaEmbed("#throw-chart", spec2, { actions: false }).catch(
                        console.error
                    );
                } else {
                    var contentDiv = document.getElementById("throw-chart");
                    contentDiv.innerHTML = "";
                }
            } else {
                // // Clear the content
                var contentDiv = document.getElementById("setup-chart");
                contentDiv.innerHTML = "";
                var contentDiv = document.getElementById("throw-chart");
                contentDiv.innerHTML = "";
            }
        }
    </script>
</body>

</html>