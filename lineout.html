<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>Rugby Lineouts</title>
    <style>
        body,
        html {
            height: 100%;
            font-family: sans-serif;
            overflow: auto;
        }

        .title {
            font-size: 48px;
            font-weight: bold;
            text-align: left;
            padding: 10px;
            color: #00a;
        }

        .subtitle {
            font-size: 15px;
            font-weight: lighter;
            text-align: left;
            font-style: italic;
            color: #00a;
            padding-bottom: 5px;
        }
    

        /* ---------- */
        /* CONTAINERS */
        /* ---------- */
        .header-panel {
            background-color: #ccddff;
            padding: 10px;
            z-index: 1;
            font: 16px sans-serif;
            height: auto;
        }
        .flex-row {
            height: max-content;
            display: flex;
            flex-direction: row;
            justify-content: left;
            padding: 0px;
        }

        .button-panel {
            border: 2px solid #111;
            background-color: #fff;
            border-radius: 10px;
            width: 25%;  
            max-width: 300px ;
            /* height: 350px; */
            /* height: 100%; */
            margin: 2px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .button-group {
            display: flex;
            flex-direction: column;
            vertical-align: bottom;
            padding: 10px;
            padding-top: 0px;
        }
        .button {
            width: 100%;
            padding: 15px;
            cursor: pointer;
            margin-bottom: 4px;
            background-color: #03c2;
            border: 2px solid #111;
            color: #111;
            font-size: 20px;
            border-radius: 6px; 
        }
        .three {
            height: 81px;
        }
        .four {
            height: 60px;
        }
        .five {
            height: 47px;
        }

        /* ------- */
        /* BUTTONS */
        /* ------- */
        
        .box-title {
            font-size: 24px;
            text-align: center;
            font-weight: bold;
            padding-top: 10px;
        }
        .box-text {
            font-size: 12px;
            font-weight: lighter;
            padding: 10px;
        }
        
        .active {
            background-color: #03c;
            color: white;
            font-weight: bold;
        }
        #Hot.active {
            background-color: red;
        }
        #Flyby.active,
        #Crusaders.active {
            background-color: orange
        }
        #Transfer.active,
        #Cold.active {
            background-color: blue;
        }

        /* Add style options for disabled button */
        .button:disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }

        input[type="checkbox"] {
            vertical-align: middle;
            position: relative;
            bottom: 2px;
            width: 20px;
            height: 20px;
            accent-color: #03c;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        /* ---------- */
        /* TEXT BOXES */
        /* ---------- */
        .text-box {
            background-color: #fff;
            width: max-content;
            text-align: center;
            padding: 20px;
            margin-left: 20px;
            margin-top: 30px;
            border-radius: 20px;
            font-weight: bolder;
            font-style: italic;
            font-size: 3vw;
        }   
        .chart-text {
            font-size: 14px;
            font-weight: lighter;
            padding-bottom: 10px;
        }

        /* --------- */
        /*  CONTENT  */
        /* --------- */
        .container {
            display: flex; 
            flex-direction: row;
        }
        .chart-container {
            padding: 10px;
            border: 2px solid #111;
            background-color: #fff;
            margin: 5px;
            border-radius: 10px;
            width: min-content;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 200px;
            overflow: scroll;
        }
        

        @media (max-width: 1800px) {

            .container {
                flex-direction: column;
            }
            .chart-container {
                width: 97%;
            }

            .chart_and_text {
                font-weight: normal;
                display: flex;
                flex-direction: row;    
                float: right;
                justify-content: space-between;
            }
            .chart-text {
                vertical-align: middle;
                float: left;
                padding: 20px;
                /* font-size: 1.25vw; */
                font-size: 10pt;
                font-weight: normal;
            }

            .button {
                font-size: 24px;
            }

            .text-box {
                display:none;
            }
        }
        
            
        #throw-chart, #setup-chart, #play-chart {
            margin-top: auto;
        }
        

    </style>
</head>

<body>
    <div class="header-panel">
        <div class="title">EGRFC - Lineout Builder</div>
        <div class="subtitle">Select the components of a lineout call to see it in full, with diagrams and a description of each part.</div>
        
        <div class="flex-row">
        <!-- ---------- -->
        <!--   NUMBERS  -->
        <!-- ---------- -->
        <div class="button-panel">
            <div class="box-title">Numbers</div>
            <div class="box-text">Number of forwards involved in the lineout</div>
            <div class="button-group" id="Numbers">
                <div class="flex-row four" style="margin-bottom: 4px;">
                    <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px;" onclick="select('n', this, '4'); select('receiver', this, '')">4</button>
                    <button class="button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; border-left: transparent;" onclick="select('n', this, '4'); select('receiver', this, '+1')">4+1</button>
                </div>
                <div class="flex-row four" style="margin-bottom: 4px;">
                    <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px;" onclick="select('n', this, '5'); select('receiver', this, '')">5</button>
                    <button class="button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; border-left: transparent;" onclick="select('n', this, '5'); select('receiver', this, '+1')">5+1</button>
                </div>
                <div class="flex-row four" style="margin-bottom: 4px;">
                    <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px;" onclick="select('n', this, '6'); select('receiver', this, '')"">6</button>
                    <button class=" button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; border-left: transparent;" onclick="select('n', this, '6'); select('receiver', this, '+1')">6+1</button>
                </div>
                <button class="button four active" onclick="select('n', this, '7'); select('receiver', this, '')" >7</button>
            </div>
        </div>

        <!-- ---------- -->
        <!--    SETUP   -->
        <!-- ---------- -->
        <div class="button-panel">
            <div class="box-title">Setup</div>
            <div class="box-text">How we line up to show the defence a different picture</div>
            <div class="button-group">
                <button class="button four" onclick="select('setup', this, 'A')">Auckland</button>
                <button class="button four" onclick="select('setup', this, 'C')">Canterbury</button>
                <button class="button four" onclick="select('setup', this, 'H')">Highlanders</button>
                <button class="button four" onclick="select('setup', this, 'W')">Waikato</button>
            </div>
        </div>

        <!-- ---------- -->
        <!--   TARGET  -->
        <!-- ---------- -->
        <div class="button-panel">
            <div class="box-title">Target</div>
            <div class="box-text">Where we want to jump: front, middle, or back</div>
            <div class="button-group">
                <button class="button three" style="font-size: 25px; line-height: 81%; padding-bottom: 10px;" onclick="select('call', this, '1')">1<br><span style="font-weight: lighter; font-size: small;">back</span></button>
                <button class="button three" style="font-size: 25px; line-height: 81%; padding-bottom: 10px;" onclick="select('call', this, '2')">2<br><span style="font-weight: lighter; font-size: small;">front</span></button>
                <button class="button three" style="font-size: 25px; line-height: 81%; padding-bottom: 10px;" onclick="select('call', this, '3')">3<br><span style="font-weight: lighter; font-size: small;">middle</span></button>
            </div>
        </div>

        <!-- ---------- -->
        <!--    PLAY    -->
        <!-- ---------- -->
        <div class="button-panel">
            <div class="box-title">Play</div>
            <div class="box-text">How we play off the lineout</div>
            <div class="button-group">
                <button class="button five active" style="padding: 6.5px;" id="Hot" onclick="select('play', this, 'Hot')">Hot</button>
                <button class="button five" disabled style="padding: 6.5px;" id="Flyby" onclick="select('play', this, 'Flyby')">Flyby</button>
                <button class="button five" style="padding: 6.5px;" id="Crusaders" onclick="select('play', this, 'Crusaders')">Crusaders</button>
                <button class="button five" disabled style="padding: 6.5px;" id="Transfer" onclick="select('play', this, 'Transfer')">Transfer</button>
                <button class="button five" style="padding: 6.5px;" id="Cold" onclick="select('play', this, 'Cold')">Cold</button>
            </div>
        </div>

        <div id="fullCallText"></div>
        </div>
        
        <label for="receiver" style="text-align: left; padding-left: 20px;">
            <div class="button-text">Receiver?<input type="checkbox" id="receiver_yn" name="receiver_yn" checked /></div>
            <script>
                // Add event listener to the checkbox
                var receiverCheckbox = document.getElementById("receiver_yn");
                receiverCheckbox.addEventListener("change", function () {
                    if (this.checked) {
                        receiver = '';
                    }
                    select('receiver_yn', this, this.checked);
                });
            </script>
        </label>

    <div class="container">
        <div class="chart-container">
            <div class="box-title">
                <span style="font-weight: lighter;">Stage 1 - </span><b +1>SETUP</b><br>
                <span style="font-weight: lighter; font-size: 16px;">Lineout is formed</span>
            </div>
            <div class="chart_and_text">
                <div class="chart-text" id="setup-text"></div>
                <div class="chart" id="setup-chart"></div>
            </div>
        </div>
        <div class="chart-container">
            <div class="box-title">
                <span style="font-weight: lighter;">Stage 2 - </span><b +1>THROW</b><br>
                <span style="font-weight: lighter; font-size: 16px;">Lineout begins</span>
            </div>
            <div class="chart_and_text">
                <div class="chart-text" id="throw-text"></div>
                <div class="chart" id="throw-chart"></div>
            </div>
        </div>
        <div class="chart-container">
            <div class="box-title">
                <span style="font-weight: lighter;">Stage 3 - </span><b>PLAY</b><br>
                <span style="font-weight: lighter; font-size: 16px;">Lineout ends</span>
            </div>
            <div class="chart-and-text">
                <div class="chart-text" id="play-text"></div>
                <div class="chart" id="play-chart" ></div>
            </div>  
        </div>
    </div>
    </div>

    <script>
        var n = 7;
        var setup = null;
        var call = null;
        var receiver = '';
        var receiver_yn = true;
        var play = "Hot";

        function select(type, element, value) {
            
            // Remove active class from all buttons 
            var buttons = document.querySelectorAll('.button[onclick^="select(\'' + type + '\', this"]');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove("active");
            }

            // Add active class to the clicked button
            element.classList.add("active");

            // Update the corresponding variable
            if (type === "n") {
                n = value;
            } else if (type === "setup") {
                setup = value;
            } else if (type === "call") {
                call = value;
            } else if (type === "receiver") {
                receiver = value;
            } else if (type === "receiver_yn") {
                receiver_yn = value;
            } else if (type === "play") {
                play = value;
            }

            //////////////////
            //   RECEIVER   //
            //////////////////
            var fourPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]");
            var fivePlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '5'); select('receiver', this, '+1')\"]");
            var sixPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '6'); select('receiver', this, '+1')\"]");
            // With receiver...
            if (receiver_yn) {
                // fourPlusOneButton.disabled = false;
                fivePlusOneButton.disabled = false;
                sixPlusOneButton.disabled = false;
            } else {
            // ...without receiver...
                // fourPlusOneButton.disabled = true;
                fivePlusOneButton.disabled = true;
                sixPlusOneButton.disabled = true;
                if (n < 7) {
                    var nButton = document.querySelector(".button[onclick=\"select('n', this, '"+n+"'); select('receiver', this, '')\"]");
                    var nPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '"+n+"'); select('receiver', this, '+1')\"]");
                    nButton.classList.add("active");
                    nPlusOneButton.classList.remove("active");
                    receiver = 'no9';
                } 
            }


            ////////////////////////////
            // SETUP TEXT DESCRIPTION //
            ////////////////////////////
            var setupText = document.getElementById("setup-text");

            if (setup === "A") {
                text =
                    "<p><b>Auckland</b> has no walk-in pod to initiate the lineout, and no obvious target. The first movement is the dummy jumper (D) attempting to commit the defensive front pod.</p>";
                // if (n === "5") {
                //     text += "The dummy jumper must rejoin the line to be front lifter (A1/A3). The back jumper either jumps (A1/A3) or lifts (A2).";
                // } else if (n === "6") {
                //     text += "The dummy jumper must rejoin the line to be front lifter (A3). The middle jumper may have to either front lift (A1), back lift (A2) or jump (A3).";
                // } else if (n === "7") {
                //     text += "The dummy jumper must rejoin the line to be front lifter (A3), or can go wherever necessary.";
                // }
                setupText.innerHTML = text;
            } else if (setup === "C") {
                text =
                    "<p><b>Canterbury</b> has a pod of 3 walking in, showing the defence a potential quick option to the middle. As the pod reaches the line, it splits rapidly to join pods at the front and back. </p>";
                // if (n === "5") {
                //     text += "The middle jumper follows whoever needs lifting (C1/C2), or else dummy lifts at the front before retreating (C3).";
                // } else if (n === "6") {
                //     text += "The walk-in pod leaves a large space in the middle to form complete pods at front (C2) and back (C1).";
                // } else if (n === "7") {
                //     text += "The middle jumper is free to hold the middle (C3), or else go wherever is necessary.";
                // }
                setupText.innerHTML = text;
            } else if (setup === "H") {
                text = "<p><b>Highlanders</b> gives nothing away to the defence, everyone but the pillars walking in evenly spaced. The key to this setup is arriving together, at speed, once the hooker is ready .</p>";
                // text += "As soon as the hooker is ready, everyone runs into the line and immediately puts up the pre-called jumper.";
                setupText.innerHTML = text;
            } else if (setup === "W") {
                text = "<p><b>Waikato</b> leaves multiple gaps in the line for potential jumpers to walk into, without any pre-formed pods, making it easy to adjust positions and change the picture for the defence.</p>";
                // if (n === "5") {
                //     text += "Two jumpers walk into two separate positions in the line (W1/W2), or they both lift in the middle (W3).";
                // } else if (n === "6") {
                //     text += "The three walk-in players can start as a pod, or in any configuration they like.";
                // } else if (n === "7") {
                //     text += "Three jumpers walk into three positions in the line - the defence cannot mark all three.";
                // }
                setupText.innerHTML = text;
            }

            ////////////////////////////
            // THROW TEXT DESCRIPTION //
            ////////////////////////////
            var throwText = document.getElementById("throw-text");
            var text = ""
            if (setup === "A") {
                if (call === "1") {
                    if (n > 5) {
                        var fpod = n - 3;
                        text = "<p>As the front " + fpod + " players distract the defence with a dummy front jump, the back 3 turn to lift the back jumper after the ball is thrown but before the defence can react.</p>"
                        // text += "The ball can be thrown at the same time as for a front jump (" + setup + "2).";
                    } else {
                        text = "<p>The front " + fpod + " players distract the defence with a dummy front jump, before the dummy jumper (D) has to rejoin the line to be a front lifter for a pod at the back.</p>"
                        // text += "This front-to-back movement makes it difficult to execute quickly, and requires the front (A2) jumper to fix the front defensive pod.";
                    }
                } else if (call === "2") {
                    text = "<p>As the dummy jumper (D) steps out of the line, the man behind him is already in a quarter squat position as a back lifter. He steps forward into the same spot to jump for the ball.</p>";
                    // text += "The 4th man in the line remains close behind the dummy pod to lift at A2.";
                } else if (call === "3") {
                    text = "<p>As the dummy jumper (D) steps out of the line, the man behind him steps forward into the same spot to dummy jump for the ball and keep attention at the front.</p>";
                    // text += "Meanwhile, the dummy jumper rejoins the line as a front lifter in the middle.";
                }
                throwText.innerHTML = text;
            } else if (setup === "C") {
                if (call === "1") {
                    text = "<p>As the walk-in pod hits the line, one player runs to the front as a decoy, and " + (n === 5 ? "two players run" : "one player runs") + " to a back pod.</p>"
                    // text += "The ball can be thrown at the same time for C1 as for C2";
                } else if (call === "2") {
                    text = "<p>As the walk-in pod hits the line, " + (n === 5 ? "two players run" : "one player runs") + " to the front pod, and one player runs to the back as a decoy.</p>"
                    // text += "The ball can be thrown at the same time for C1 as for C2";
                } else if (call === "3") {
                    // text = "<p>As the walk-in pod hits the line, " + (n === 5 ? "two players run" : "one player runs") + " to the front pod, and one player runs to the back as a decoy.</p>"
                    if (n === '5') {
                        text = "<p>After splitting to the front and back, there is a <em>dummy</em> jump at the front, the back lifter becomes the jumper in the middle</p>";
                    } else if (n === '6') {
                        text = "<p>After dummy jumps at both C1 and C2, the 3 players who <em>weren't</em> in the walk-in pod form a pod in the middle (C1 and C3 use the same jumper)</p>.";
                    } else {
                        text = "<p>After dummy jumps at both C1 and C2, the two nearest players already facing the middle jumper come forward to lift in the middle.</p>";
                    }
                }
                throwText.innerHTML = text;
            } else if (setup === "H") {
                text ="<p>This is the simplest setup, as it involves the least movement and the fewest people (only the jumper and the lifters either side of him).</p>"
                
                // if (call === "3") {
                //     if (n < 7) {
                //         text += "A 5- or 6-man H3 is an unlikely call because the jumper can be easily marked by the defence, unless it is executed quickly in an undefended area.";
                //     } else {
                //         text += "A 7-man H3 allows both the front and back jumpers to use their movement to present multiple threats.";
                //     }
                // } else {
                //     text += "Optionally, front and back pods can both be used to present multiple threats to the defence, with one of them being a decoy (similar to C1/C2).";
                // }
                throwText.innerHTML = text;
            } else if(setup === "W") {
                if (n != '6'){
                    text = "<p>" + n + "-man Waikato is very similar to Highlanders, except the movement is focused on the jumpers, with the lifters already in place, showing the defence a different picture.</p>";
                } else {
                    text = "<p>The 6-man variant of Waikato can create the impression of a walk-in pod of 3 together, or spaced out to suit the call.</p>";
                    // if (call === "3") {
                    //     text += "The middle jumper can choose his position without posing a threat to the defence until he is joined by 2 lifters walking in.";
                    // } else {
                    //     text += "Depending on how the players join the line, W" + call + " can use the middle jumper as a lifter or else in a dummy pod at the " + ((call === '1') ? "front" : "back") + ".";
                    // }
                }
                throwText.innerHTML = text;
            }

            ///////////////////////////
            // PLAY TEXT DESCRIPTION //
            ///////////////////////////
            var playText = document.getElementById("play-text");
            var text = ""
            if (play === "Hot") {
                text = "<p>This is the default play off the top of the lineout to the scrum half. The half backs really don't want front ball at the lineout ("+ setup + call +") because it puts more pressure on longer passes.</p>";
            } else if (play === "Crusaders") {
                text = "<p><b>Crusaders</b> is a play that initiates a maul, but leaves forward options on one or both sides to carry into the space vacated by defenders joining the maul.</p>";
            } else if (play === "Cold") {
                text = "<p>With or without a scrum half, any lineout can form a maul. The nearest forward to the jumping pod will be first over the ball to initiate the maul, before others join to form a long, narrow formation.</p>";
            }
            playText.innerHTML = text;

            ///////////////////////////
            //      LOAD CHARTS      //
            ///////////////////////////
            if (n !== null && setup !== null) {
                var spec1 =
                    "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/setup_" +
                    n +
                    (receiver_yn ? receiver : 'no9') +
                    "_" +
                    setup +
                    ".json";
                vegaEmbed("#setup-chart", spec1, { actions: false }).catch(
                    console.error
                );

                if (call !== null) {
                    var numbers = n + (receiver === '+1' ? receiver : '-man');
                    var fullcall = setup + call + (play === null ? '' : (' ' + play));
                    document.getElementById("fullCallText").innerHTML = '<div class="text-box">\"' + numbers + ' ' + fullcall + '\"</div>';

                    var spec2 =
                        "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/throw_" +
                        n +
                        (receiver_yn ? receiver : 'no9') +
                        "_" +
                        setup +
                        call +
                        ".json";
                    vegaEmbed("#throw-chart", spec2, { actions: false }).catch(
                        console.error
                    );
                    if (play !== null) {
                        var spec3 =
                            "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/play_" +
                            n +
                            (receiver_yn ? receiver : 'no9') +
                            "_" +
                            setup +
                            call +
                            '_' +
                            play +
                            ".json";
                        vegaEmbed("#play-chart", spec3, { actions: false }).catch(
                            console.error
                        );
                    } else {
                        var contentDiv = document.getElementById("play-chart");
                        contentDiv.innerHTML = "";
                    }
                } else {
                    var contentDiv = document.getElementById("throw-chart");
                    contentDiv.innerHTML = "";
                }
            } else {
                // // Clear the content
                var contentDiv = document.getElementById("setup-chart");
                contentDiv.innerHTML = "";
                var contentDiv = document.getElementById("throw-chart");
                contentDiv.innerHTML = "";
            }
        }

        ////////////////////////////////////
        // TEMPORARY - BUTTONS TO DISABLE //
        ////////////////////////////////////

        // // Disable all play buttons
        // var playButtons = document.querySelectorAll('.button[onclick^="select(\'play\', this"]');
        // for (var i = 0; i < playButtons.length; i++) {
        //     playButtons[i].disabled = true;
        // }

        // Disable 4/4+1 buttons
        var fourPlusOneButton = document.querySelector(
            ".button[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]"
        );
        var fourManButton = document.querySelector(
            ".button[onclick=\"select('n', this, '4'); select('receiver', this, '')\"]"
        );
        fourPlusOneButton.disabled = true;
        fourManButton.disabled = true;
        

    </script>
</body>

</html> 