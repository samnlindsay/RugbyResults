<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <title>Rugby Lineouts</title>
    <style>
        body,
        html {
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
        }

        .title {
            font-size: 48px;
            font-weight: bold;
            text-align: left;
            padding: 10px;
            color: #03c;
        }

        .subtitle {
            font-size: 15px;
            font-weight: lighter;
            text-align: left;
            font-style: italic;
            color: #03c;
            padding-bottom: 5px;
        }

        .selections {
            background-color: #ccddff;
            padding: 10px;
            z-index: 1;
            font: 16px sans-serif;
            height: auto;
        }

        .box-title {
            font-size: 24px;
            text-align: center;
            /* font-weight: bold; */
            padding: 5px;
        }

        .button-text {
            font-size: 12px;
            font-weight: lighter;
            padding-bottom: 10px;
        }

        .tablinks {
            width: 100%;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 3px;
            background-color: #03c2;
            border: 2px solid #111;
            color: #111;
            font-size: 20px;
            border-radius: 6px; 
        }

        .active {
            background-color: #03c;
            color: white;
            font-weight: bold;
        }

        #Hot.active {
            background-color: red;
        }

        #Flyby.active,
        #Crusaders.active {
            background-color: orange
        }

        #Transfer.active,
        #Cold.active {
            background-color: blue;
        }

        .button-group {
            border: 2px solid #111;
            background-color: #fff;
            display: inline-block;
            vertical-align: top;
            width: 150px;
            padding: 10px;
            padding-top: 0px;
            border-radius: 10px;
        }

        .text-box {
            /* border: 2px solid #111; */
            background-color: #fff;
            vertical-align: top;
            display: inline-block;
            text-align: center;
            margin-left: 50px;
            margin-top: 50px;
            padding: 30px;
            border-radius: 20px;
            font-weight: bold;
            font-style: italic;
            font-size: 60pt;
            /* color: #03c */
        }   

        /* Add style options for disabled button */
        .tablinks:disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }

        input[type="checkbox"] {
            vertical-align: middle;
            position: relative;
            bottom: 2px;
            width: 20px;
            height: 20px;
            accent-color: #03c;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        .chart-text {
            font-size: 14px;
            font-weight: lighter;
            padding-bottom: 10px;
        }

        .chart-container {
            padding: 10px;
            border: 2px solid #111;
            background-color: #fff;
            margin: 5px;
            border-radius: 10px;
            width: 30%;
            display: flex;
            flex-direction: column;
        }
            
        #throw-chart, #setup-chart, #play-chart {
            margin-top: auto;
        }
        

    </style>
</head>

<body>
    <div class="selections">
        <div class="title">EGRFC - Lineout Builder</div>
        <div class="subtitle">
            Select the components of a lineout call to see it in full, with diagrams and a description of each part.
        </div>
        <div style="display: inline-block;">
        <div class="button-group" style="width: 135px;">
            <div class="box-title">Numbers</div>
            <div class="button-text">Number of forwards involved in the lineout</div>
            <button class="tablinks" style="width: 55px" onclick="select('n', this, '4'); select('receiver', this, '')">4</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '4'); select('receiver', this, '+1')">4+1</button>
            <button class="tablinks" style="width: 55px" onclick="select('n', this, '5'); select('receiver', this, '')">5</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '5'); select('receiver', this, '+1')">5+1</button>
            <button class="tablinks" style="width: 55px" onclick="select('n', this, '6'); select('receiver', this, '')">6</button>
            <button class="tablinks" style="width: 75px" onclick="select('n', this, '6'); select('receiver', this, '+1')">6+1</button>
            <button class="tablinks" onclick="select('n', this, '7'); select('receiver', this, '9')">7</button>
        </div>
        <label for="receiver" style="text-align: right; padding-right: 20px;">
            <div class="button-text">Receiver?<input type="checkbox" id="receiver_yn" name="receiver_yn" checked /></div>
            <script>
                var n = null;
                var setup = null;
                // Add event listener to the checkbox
                var receiverCheckbox = document.getElementById("receiver_yn");
                receiverCheckbox.addEventListener("change", function () {
                    select('receiver_yn', this, this.checked ? 'Y' : 'N');
                });
            </script>
        </label>
        </div>

        <div class="button-group">
            <div class="box-title">Setup</div>
            <div class="button-text">
                How we line up to show the defence a different picture
            </div>
            <button class="tablinks" onclick="select('setup', this, 'A')">Auckland</button>
            <button class="tablinks" onclick="select('setup', this, 'C')">Canterbury</button>
            <button class="tablinks" onclick="select('setup', this, 'H')">Highlanders</button>
            <button class="tablinks" onclick="select('setup', this, 'W')">Waikato</button>
        </div>
        <div class="button-group" style="width: 130px;">
            <div class="box-title">Target</div>
            <div class="button-text">Where we want to jump: front, middle, or back</div>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '1')">1<br><span style="font-weight: lighter; font-size: small;">back</span></button>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '2')">2<br><span style="font-weight: lighter; font-size: small;">front</span></button>
            <button class="tablinks" style="font-size: 25px; line-height: 81%; padding-bottom: 4px;" onclick="select('call', this, '3')">3<br><span style="font-weight: lighter; font-size: small;">middle</span></button>
        </div>
        <div class="button-group" style="width: 150px">
            <div class="box-title">Play</div>
            <div class="button-text">How we play off the lineout</div>
            <button class="tablinks" style="padding: 6.5px;" id="Hot" onclick="select('play', this, 'Hot')">Hot</button><br />
            <button class="tablinks" style="padding: 6.5px;" id="Flyby" onclick="select('play', this, 'Flyby')">Flyby</button><br />
            <button class="tablinks" style="padding: 6.5px;" id="Crusaders" onclick="select('play', this, 'Crusaders')">Crusaders</button>
            <button class="tablinks" style="padding: 6.5px;" id="Transfer" onclick="select('play', this, 'Transfer')">Transfer</button>
            <button class="tablinks" style="padding: 6.5px;" id="Cold" onclick="select('play', this, 'Cold')">Cold</button>
        </div>
        <span id="fullCallText"></span>
    </div>


    <div class="container" style="width: 100%; display: flex; justify-content: left">
        <div class="chart-container">
            <div class="box-title"><span style="font-weight: lighter;">Stage 1 - </span><b +1>SETUP</b></div>
            <div class="chart-text" id="setup-text"></div>
            <div id="setup-chart"></div>
        </div>
        <div class="chart-container">
            <div class="box-title"><span style="font-weight: lighter;">Stage 2 - </span><b +1>THROW</b></div>
            <div class="chart-text" id="throw-text"></div>
            <div id="throw-chart"></div>
        </div>
        <div class="chart-container">
            <div class="box-title"><span style="font-weight: lighter;">Stage 3 - </span><b +1>PLAY</b></div>
            <div class="chart-text" id="play-text"></div>
            <div style="text-align: center;"><img src="https://pngimg.com/uploads/under_construction/under_construction_PNG40.png" alt="Under Construction" style="width: 50%"></div>
            <div id="play-chart" ></div>
        </div>
    </div>

    <script>
        var n = null;
        var setup = null;
        var call = null;
        var receiver = "";
        var receiver_yn = "Y";
        var play = null;

        function select(type, element, value) {
            // Remove active class from all buttons of the same type
            var buttons = element.parentNode.querySelectorAll(".tablinks");
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove("active");
            }

            // Add active class to the clicked button
            element.classList.add("active");

            // Update the corresponding variable
            if (type === "n") {
                n = value;
            } else if (type === "setup") {
                setup = value;
            } else if (type === "call") {
                call = value;
            } else if (type === "receiver") {
                receiver = value;
            } else if (type === "receiver_yn") {
                receiver_yn = value;
            } else if (type === "play") {
                play = value;
            }

            
            ////////////////////////////
            //     DISABLE BUTTONS    //
            ////////////////////////////

            // When the receiver checkbox is checked, disable the 4+1, 5+1 and 6+1 buttons
            var fourPlusOneButton = document.querySelector(".tablinks[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]");
            var fivePlusOneButton = document.querySelector(".tablinks[onclick=\"select('n', this, '5'); select('receiver', this, '+1')\"]");
            var sixPlusOneButton = document.querySelector(".tablinks[onclick=\"select('n', this, '6'); select('receiver', this, '+1')\"]");
            if (receiver_yn === 'N') {
                // fourPlusOneButton.disabled = true;
                fivePlusOneButton.disabled = true;
                sixPlusOneButton.disabled = true;
            } else {
                // fourPlusOneButton.disabled = false;
                fivePlusOneButton.disabled = false;
                sixPlusOneButton.disabled = false;
            }

            ////////////////////////////
            // SETUP TEXT DESCRIPTION //
            ////////////////////////////
            var setupText = document.getElementById("setup-text");

            if (setup === "A") {
                text =
                    "<p><b>Auckland</b> has no walk-in pod to initiate the lineout, and no obvious target. The first movement is the dummy jumper (D) attempting to commit the defensive front pod.</p>";
                if (n === "5") {
                    text += "The dummy jumper must rejoin the line to be front lifter (A1/A3). The back jumper either jumps (A1/A3) or lifts (A2).";
                } else if (n === "6") {
                    text += "The dummy jumper must rejoin the line to be front lifter (A3). The middle jumper may have to either front lift (A1), back lift (A2) or jump (A3).";
                } else if (n === "7") {
                    text += "The dummy jumper must rejoin the line to be front lifter (A3), or can go wherever necessary.";
                }
                setupText.innerHTML = text;
            } else if (setup === "C") {
                text =
                    "<p><b>Canterbury</b> has a pod of 3 walking in, showing the defence a potential quick option to the middle. As the pod reaches the line, it splits rapidly to join pods at the front and back. </p>";
                if (n === "5") {
                    text += "The middle jumper follows whoever needs lifting (C1/C2), or else dummy lifts at the front before retreating (C3).";
                } else if (n === "6") {
                    text += "The walk-in pod leaves a large space in the middle to form complete pods at front (C2) and back (C1).";
                } else if (n === "7") {
                    text += "The middle jumper is free to hold the middle (C3), or else go wherever is necessary.";
                }
                setupText.innerHTML = text;
            } else if (setup === "H") {
                text = "<p><b>Highlanders</b> gives nothing away to the defence, everyone but the pillars walking in evenly spaced. As soon as the hooker is ready, everyone runs into the line and immediately puts up the pre-called jumper.</p>";
            } else if (setup === "W") {
                text = "<p><b>Waikato</b> leaves multiple gaps in the line for potential jumpers to walk into, without any pre-formed pods, making it easy to adjust positions and change the picture for the defence.</p>";
                if (n === "5") {
                    text += "Two jumpers walk into two separate positions in the line (W1/W2), or they both lift in the middle (W3).";
                } else if (n === "6") {
                    text += "The three walk-in players can start as a pod, or in any configuration they like.";
                } else if (n === "7") {
                    text += "Three jumpers walk into three positions in the line - the defence cannot mark all three.";
                }
            }
            setupText.innerHTML = text;

            /////////////////////////
            //      CALL TEXT      //
            /////////////////////////
            if (n !== null && setup !== null && call !== null) {
                var numbers = n + (receiver === '+1' ? receiver : '-man');
                
                if (play !== null) {
                    var fullcall = setup + call + ' ' + play;
                } else {
                    var fullcall = setup + call;
                }
                document.getElementById("fullCallText").innerHTML = '<div class="text-box">\"' + numbers + ' ' + fullcall + '\"</div>';
            } else {
                document.getElementById("fullCallText").innerHTML = '';
            }

            ///////////////////////////
            //      LOAD CHARTS      //
            ///////////////////////////
            if (n !== null && setup !== null) {
                var spec1 =
                    "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/setup_" +
                    n +
                    (receiver_yn==='Y' ? receiver : 'no9') +
                    "_" +
                    setup +
                    ".json";
                vegaEmbed("#setup-chart", spec1, { actions: false }).catch(
                    console.error
                );

                if (call !== null) {
                    var spec2 =
                        "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/throw_" +
                        n +
                        (receiver_yn === 'Y' ? receiver : 'no9') +
                        "_" +
                        setup +
                        call +
                        ".json";
                    vegaEmbed("#throw-chart", spec2, { actions: false }).catch(
                        console.error
                    );
                    // if (play !== null) {
                    //     var spec3 =
                    //         "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/play_" +
                    //         n +
                    //         (receiver_yn === 'Y' ? receiver : 'no9') +
                    //         "_" +
                    //         setup +
                    //         call +
                    //         play +
                    //         ".json";
                    //     vegaEmbed("#play-chart", spec3, { actions: false }).catch(
                    //         console.error
                    //     );
                    // } else {
                    //     var contentDiv = document.getElementById("play-chart");
                    //     contentDiv.innerHTML = "";
                    // }
                } else {
                    var contentDiv = document.getElementById("throw-chart");
                    contentDiv.innerHTML = "";
                }
            } else {
                // // Clear the content
                var contentDiv = document.getElementById("setup-chart");
                contentDiv.innerHTML = "";
                var contentDiv = document.getElementById("throw-chart");
                contentDiv.innerHTML = "";
            }
        }

        ////////////////////////////////////
        // TEMPORARY - BUTTONS TO DISABLE //
        ////////////////////////////////////

        // Disable all play buttons
        var playButtons = document.querySelectorAll('.tablinks[onclick^="select(\'play\', this"]');
        for (var i = 0; i < playButtons.length; i++) {
            playButtons[i].disabled = true;
        }

        // Disable 4/4+1 buttons
        var fourPlusOneButton = document.querySelector(
            ".tablinks[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]"
        );
        var fourManButton = document.querySelector(
            ".tablinks[onclick=\"select('n', this, '4'); select('receiver', this, '')\"]"
        );
        fourPlusOneButton.disabled = true;
        fourManButton.disabled = true;
        

    </script>
</body>

</html>