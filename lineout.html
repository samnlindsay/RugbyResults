<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="min-width=800, initial-scale=1.0"> -->
    <title>Lineout Builder</title>
    <style>
        body,
        html {
            margin: 0px; 
            padding: 0px;
            height: 100%;
            font-family: sans-serif;
            overflow: scroll;
            text-size-adjust: none;
            background-color: hsl(225, 100%, 95%);
        }

        hr {
            border: 2px solid hsl(225, 100%, 20%);
        }

        h2 {
            font-size: xx-large; 
            /* font-style: italic; */
            color: hsl(225, 100%, 0%)
        }

        .main-body {
            font: 16px sans-serif;
            overflow: scroll;
            max-width: 1040px;
            margin-left: auto;
            margin-right: auto;
        }
        .banner {
            display: flex; 
            justify-content: space-between; 
            background-color: hsl(225, 100%, 20%); 
            padding: 10px;
            z-index: 1;
            font: 16px sans-serif;
            height: auto;
            overflow: scroll;
            overflow-x: scroll;
        }
        .flex-row {
            height: max-content;
            display: flex;
            flex-direction: row;
            justify-content: left;
            padding: 0px;
            max-width: 1020px;
        }
        .flex-column {
            width: max-content;
            display: flex;
            flex-direction: column;
            /* justify-content: space-around; */
            padding: 0px;
        }

        #call-summary {
            display: none; 
            height: max-content; 
            max-width: 1010px;
            justify-content: space-around; 
            border: 2px solid black; 
            padding: 20px 0; 
            background-color: hsl(0, 100%, 95%);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .button-panel {
            border: 2px solid #111;
            background-color: #fff;
            border-radius: 10px;
            width: 20%; 
            min-width: fit-content; 
            margin: 2px;
            display: flex;
            flex: 1;
            flex-direction: column;
            justify-content: left;
        }
        .button-group, .target-button-group, .play-button-group {
            display: flex;
            flex-direction: column;
            vertical-align: bottom;
            padding: 10px;
            padding-top: 0px;
        }
        .button {
            width: 100%;
            padding: 15px;
            cursor: pointer;
            margin-bottom: 4px;
            background-color: hsl(225, 100%, 95%);
            border: 2px solid black;
            color: black;
            font-size: x-large;
            border-radius: 6px;
            box-shadow: 0 0 3px hsl(225, 100%, 20%);
        }

        .button:hover {
            border: 4px solid hsl(225, 100%, 20%);
            box-shadow: inset 0 0 5px hsl(225, 100%, 20%);
        }
        .three {
            height: 81px;
        }
        .four {
            height: 60px;
        }
        .five {
            height: 47px;
        }

        /* ------- */
        /* BUTTONS */
        /* ------- */
        
        .button-title {
            font-size: x-large;
            text-align: center;
            font-weight: bold;
            padding-top: 10px;
            padding-bottom: 10px;
            color: hsl(225, 100%, 20%);
        }
        
        .button.active {
            background-color: hsl(225, 100%, 40%);
            color: white;
            font-weight: bolder;
            font-weight: 900;
            border: 3px solid black;
            box-shadow: inset 0 0 5px hsl(225, 100%, 20%);
        }
        
        #Hot {
            background-color: hsl(0, 100%, 95%);
        }
        #Hot.active {
            background-color: hsl(0, 100%, 50%);
        }
        #Cold {
            background-color: hsl(240, 100%, 95%);
        }
        #Cold.active {
            background-color: hsl(240, 100%, 50%);
        }

        #Flyby,
        #Crusaders {
            background-color: #fd84;
        }

        #Flyby.active,
        #Crusaders.active {
            background-color: #fd8;
            color: black;
        }
        
        /* Add style options for disabled button */
        .button:disabled {
            cursor: not-allowed;
            opacity: 0.2;
        }

        input[type="checkbox"] {
            vertical-align: middle;
            position: relative;
            bottom: 2px;
            width: 20px;
            height: 20px;
            accent-color: hsl(225, 100%, 40%);
        }

        label {
            display: block;
            margin-top: 10px;
        }

        /* ---------- */
        /* TEXT BOXES */
        /* ---------- */
        
        .speech {
            width: max-content;
            height: fit-content;
            background:white; 
            padding: 15px; 
            text-align: center; 
            font-size: xx-large; 
            font-style: italic;
            font-weight: bold;
            position:relative;
            border-style: solid;
            border-radius: 25px;
            border:6px solid hsl(225, 100%, 20%);
            color:hsl(225, 100%, 20%);
            background-color: hsl(225, 100%, 95%);
            
        }
        /* creates a small circle to produce a rounded point where the two curves meet */
        .speech > :first-child:before {
            content:"";
            position:absolute;
            bottom:-36px;
            left:36px;
            width:6px;
            height:6px;
            background:hsl(225, 100%, 20%);
            border-radius:9px;
        }

        /* creates larger curve */
        .speech:before {
            content:"";
            position:absolute;
            z-index:10;
            bottom:-36px;
            left:40px;
            width:50px;
            height:30px;
            border-style:solid;
            border-width: 0 6px 6px 0;
            background: transparent;
            border-bottom-right-radius:80px 50px;
        }

        /* creates smaller curve */
        .speech:after {
            content:"";
            position:absolute;
            z-index:10;
            bottom:-36px;
            left:40px;
            width:20px;
            height:30px;
            border-style:solid;
            border-width:0 6px 6px 0;
            background:transparent;
            border-bottom-right-radius:40px 50px;
        }

        /* creates a triangle to cover part of the oval border*/
        .speech > :first-child:after {
            content:"";
            z-index: 0;
            position:absolute;
            bottom:-33px;
            left:63px;
            width: 0px;
            height: 0px;
            border-style: solid;
            border-width: 40px 40px 0 0;
            border-color: hsl(225, 100%, 95%) transparent transparent transparent;
            transform: rotate(0deg);
        }
           
        .chart-text {
            font-size: medium;
            font-weight: light;
            margin: 0px 0px -10px 0px;
            padding: 0px;
            justify-self: space-around;
        }

        .backs-text {
            font-weight: normal;
            border: 5px solid red;
            border-radius: 20px; 
            background-color: hsl(0, 100%, 95%); 
            padding-right: 15px; 
            font-size: 20px; 
            margin:10px;
            width: max-content;
        }

        path {
            stroke-width: 4px;
            stroke-linejoin: round;
        }

        /* --------- */
        /*  CONTENT  */
        /* --------- */
        .container {
            /* display: none;  */
            flex-direction: column;
            width: 100%;
            height: max-content;
            max-width: 1020px;
            padding: 0px;
            /* margin: 10px; */
        }
        .chart-title {
            display: block;
            font-size: x-large;
            text-align: center;
            font-weight: bold;
            padding-top: 10px 0px;
            padding-bottom: 10px;
            color: hsl(225, 100%, 20%);
        }
        .chart-container {
            padding: 10px;
            border: 2px solid hsl(225, 100%, 20%);
            background-color: white;
            margin: 0px 10px 10px 0px;
            border-radius: 10px 0px 10px 10px;
            max-width: 1020px;
            min-width: 700px;
            flex:1;
            min-height: 200px;
            text-align: center;
            justify-self: center;
            justify-content: center;
            /* display: none; */
        }

        .row-button {
            font-size: x-large;
            font-weight: bold;
            cursor: pointer;
            width: 150px;
            padding-top: 10px;
            padding-bottom: 2px;
            border-radius: 10px 10px 0px 0px;
            margin: 0px;
            margin-top: 40px;
            border: 2px solid hsl(225, 100%, 20%);
            border-bottom: none;
            color:hsl(0, 0%, 50%);
            justify-content: right;
            line-height: 80%;
        }
        .row-button:hover {
            /* border: 4px solid hsl(225, 100%, 20%); */
            box-shadow: 0 0 5px hsl(225, 100%, 20%);
            color: hsl(225, 100%, 20%);
        }
        .row-button.active {
            color: white;
            background-color: hsl(225, 100%, 40%);

        }
            
        #throw-chart, #setup-chart, #play-chart {
            margin-top: auto;
        }
        

    </style>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YHTVJ4HXMR"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-YHTVJ4HXMR');
</script>

<body>
    <div class="banner">
        <div style="min-width: 600px; margin: 5px;">
            <h1 style="font-size: 60px;font-weight: bold; font-style: italic; color: white; margin: -10px 0px; display: flex; align-items: center;">
                <img src="https://img-res.pitchero.com/?url=images.pitchero.com%2Fclub_logos%2F4860%2Fq8XL0Ot4QSqgy8nOKnCb_Logo.png" alt="EGRFC logo" style="width: 100px; height: 100px; padding: 10px; margin-right: 15px;">
                Lineout Builder
            </h1>
        </div>
        <div style="max-width: 370px;">
            <h4 style="font-size:medium; color: #fffa; font-style: italic; line-height: 150%; background-color: hsl(225, 100%, 20%); text-align:right; ">
                Use any combination of these calls to create over 200 potential lineout options
                <br>For more detail go to <a href="https://www.google.com/url?q=http://www.tinyurl.com/egrfc-playbook&sa=D&source=editors&ust=1720432392092945&usg=AOvVaw1c_PAmx1zpYAtXqVlPwueX">EGRFC Playbook</a>
            </h4>
        </div>
    </div>
    <div class="main-body">
        <div style="display: flex; justify-content: space-between; align-items: center; margin: -10px 10px;">
            <div class="column" style="width: 25%;"><h2>Call selection</h2></div>
            <div class="column" style="width: 75%; font-style: italic; text-align:right;">Select these 4 components of a call to fully define a lineout from initial setup to first phase</div>
        </div>
        <div class="flex-row" style="margin: 0px 10px;">
            <!-- ---------- -->
            <!--   NUMBERS  -->
            <!-- ---------- -->
            <div class="button-panel" style="border-bottom-left-radius: 0px; flex:2; max-width: 240px;">
                <div class="button-title">Numbers</div>
                <div class="button-group" id="Numbers">
                    <div class="flex-row four" style="margin-bottom: 4px;">
                        <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px;" onclick="select('n', this, '4'); select('receiver', this, '')">4</button>
                        <button class="button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; margin-left: -2px;" onclick="select('n', this, '4'); select('receiver', this, '+1')">4+1</button>
                    </div>
                    <div class="flex-row four" style="margin-bottom: 4px;">
                        <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px; margin-right: -1px;" onclick="select('n', this, '5'); select('receiver', this, '')">5</button>
                        <button class="button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; margin-left: -1px;" onclick="select('n', this, '5'); select('receiver', this, '+1')">5+1</button>
                    </div>
                    <div class="flex-row four" style="margin-bottom: 4px;">
                        <button class="button" style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;margin: 0px;" onclick="select('n', this, '6'); select('receiver', this, '')"">6</button>
                        <button class=" button" style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;margin: 0px; margin-left: -2px;" onclick="select('n', this, '6'); select('receiver', this, '+1')">6+1</button>
                    </div>
                    <button class="button four" onclick="select('n', this, '7'); select('receiver', this, '')" >7</button>
                </div>
            </div>
            <!-- ---------- -->
            <!--    SETUP   -->
            <!-- ---------- -->
            <div class="button-panel" style="flex:2; max-width: 220px;">
                <div class="button-title">Setup</div>
                <div class="button-group">
                    <button class="button four" onclick="select('setup', this, 'A')">Auckland</button>
                    <button class="button four" onclick="select('setup', this, 'C')">Canterbury</button>
                    <button class="button four" onclick="select('setup', this, 'H')">Highlanders</button>
                    <button class="button four" onclick="select('setup', this, 'W')">Waikato</button>
                </div>
            </div>
            <!-- ---------- -->
            <!--   TARGET  -->
            <!-- ---------- -->
            <div class="button-panel" style="flex:1; max-width: 150px;">
                <div class="button-title">Target</div>
                <div class="target-button-group">
                    <button class="button three" style="padding-bottom: 10px;" onclick="select('call', this, '1')">1<br><span style="font-size: small;">back</span></button>
                    <button class="button three" style="padding-bottom: 10px;" onclick="select('call', this, '2')">2<br><span style="font-size: small;">front</span></button>
                    <button class="button three" style="padding-bottom: 10px;" onclick="select('call', this, '3')">3<br><span style="font-size: small;">middle</span></button>
                </div>
            </div>
            <!-- ---------- -->
            <!--    PLAY    -->
            <!-- ---------- -->
            <div class="button-panel" style="flex:2; max-width: 220px;">
                <div class="button-title">Play</div>
                <div class="play-button-group">
                    <button class="button four" style="padding: 6.5px;" id="Hot" onclick="select('play', this, 'Hot')">Hot</button>
                    <button class="button four" style="padding: 6.5px;" id="Flyby" onclick="select('play', this, 'Flyby')">Flyby</button>
                    <button class="button four" style="padding: 6.5px;" id="Crusaders" onclick="select('play', this, 'Crusaders')">Crusaders</button>
                    <!-- <button class="button five" disabled style="padding: 6.5px;" id="Transfer" onclick="select('play', this, 'Transfer')">Transfer</button> -->
                    <button class="button four" style="padding: 6.5px;" id="Cold" onclick="select('play', this, 'Cold')">Cold</button>
                </div>
            </div>
        </div>
        <!-- ----------------- -->
        <!--  Receiver button  -->
        <!-- ----------------- -->
        <label for="receiver" style="color: hsl(225, 100%, 20%); background-color:white; text-align: left; margin: -3px 12px; padding: 10px 10px 5px 10px; border: 2px solid hsl(225, 100%, 20%); width: max-content; border-radius: 0 0 10px 10px; border-top:none;">
            <div class="button-text" style="font-weight: bold;">Receiver?<input type="checkbox" id="receiver_yn" name="receiver_yn" checked /></div>
            <script>
                // Add event listener to the checkbox
                var receiverCheckbox = document.getElementById("receiver_yn");
                receiverCheckbox.addEventListener("change", function () {
                    if (this.checked) {
                        receiver = '';
                    }
                    select('receiver_yn', this, this.checked);
                });
            </script>
        </label>
        
        <hr>
        
        <div class="container">
            <div id="diagram-title" style="display: flex; justify-content: space-between; align-items: center; margin: -10px 10px -40px 10px; padding: 0px;">
                <div class="column">
                    <h2>Step-by-step diagrams</h2>
                </div>
                <div class="column" style="text-align:right; font-style: italic;">View all 3 stages of the lineout to see how a specific call is run.
                    <br>Or view one stage and see how it changes for different calls.</div>
            </div>
                
            <div class="flex-row" style="align-self: flex-end; padding-right: 10px;">
                <button class="row-button" id="setup-panel" onclick="openTab(event, 'setup')">
                    Setup<br><span style="font-weight: normal; font-size: small;">Lineout forms</span>
                </button>
                <button class="row-button" id="throw-panel" onclick="openTab(event, 'throw')">
                    Throw<br><span style="font-weight: normal; font-size: small">Lineout begins</span>
                </button>
                <button class="row-button" id="play-panel" onclick="openTab(event, 'play')">
                    Play<br><span style="font-weight: normal; font-size: small">Lineout ends</span>
                </button>
            </div>
            
            <!-- ---------- -->
            <!--    SETUP   -->
            <!-- ---------- -->
            <div class="chart-container" id="setup" style="display: block; margin: 0px 10px;">
                <div class="chart" id="setup-chart"></div>
                <div class="chart-text" id="setup-text"></div>
            </div>
            <!-- ---------- -->
            <!--    THROW   -->
            <!-- ---------- -->
            <div class="chart-container" id="throw" style="margin: 0px 10px;">
                <div class="chart" id="throw-chart"></div>
                <div class="chart-text" id="throw-text"></div>
            </div>
            <!-- ---------- -->
            <!--    PLAY    --> 
            <!-- ---------- -->
            <div class="chart-container" id="play" style="margin: 0px 10px;">
                <div class="chart" id="play-chart"></div>
                <div class="chart-text" id="play-text"></div>
            </div>
        </div>

        <!-- ------------------- -->
        <!--  Call summary text  -->
        <!-- ------------------- -->
        <div class="flex-row" id="call-summary" style="margin: 10px;">
            <div style="margin-left: 20px;">
                <span
                    style="font-size: x-large; font-style: italic; font-weight: bold; color: hsl(225, 100%, 20%); width: 100%;">What
                    the
                    forwards say...</span>
                <div class="speech" style="margin: 10px;">
                    <div id="fullCallText"></div>
                </div>
            </div>
            <div style="margin: 10px; text-align: center;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -5 105 105" width="110" height="110">
                    <path style="fill:hsl(0, 100%, 90%);"
                        d="M46.967,0C21.029,0,0,21.028,0,46.967c0,25.939,21.029,46.967,46.967,46.967c25.939,0,46.967-21.027,46.967-46.967 C93.934,21.027,72.906,0,46.967,0z" />
                    <path style="fill: white; stroke: hsl(225, 100%, 20%);"
                        d="M55.953,66.295V54.3H18.652V39.634h37.303V27.639l19.326,19.328L55.953,66.295z" />
                </svg>
            </div>
            <div>
                <span style="font-size: x-large; font-style: italic; font-weight: bold; color: red;">What the backs need to
                    know...</span>
                <div class="backs-text" id="backsText"></div>
            </div>
        </div>

    </div>
    <script>
        var n = 7;
        var setup = "C";
        var call = "1";
        var receiver = '';
        var receiver_yn = true;
        var play = "Hot";

        // Simulate clicks on loading
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('button[onclick*="select(\'n\', this, \'7\')"]').click();
            document.querySelector('button[onclick*="select(\'setup\', this, \'C\')"]').click();
            document.querySelector('button[onclick*="select(\'call\', this, \'1\')"]').click();
            document.querySelector('button[id="Hot"]').click();
            document.querySelector('button[id="setup-panel"]').click();
        });

        function select(type, element, value) {
            // Remove active class from all buttons 
            var buttons = document.querySelectorAll('.button[onclick^="select(\'' + type + '\', this"]');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove("active");
            }

            // Add active class to the clicked button
            element.classList.add("active");

            // Update the corresponding variable
            if (type === "n") {
                n = value;
                if (value > 4 && !document.querySelector('.button[onclick^="select(\'setup\', this"].active')) {
                    setup = "C";
                    document.querySelector('.button[onclick^="select(\'setup\', this"][onclick*="'+setup+'"]').classList.add("active");
                    call = play === "Hot" ? "1" : "3";
                    document.querySelector('.button[onclick^="select(\'call\', this"][onclick*="'+call+'"]').classList.add("active");
                }
            } else if (type === "setup") {
                setup = value;
            } else if (type === "call") {
                call = value;
            } else if (type === "receiver") {
                receiver = value;
            } else if (type === "receiver_yn") {
                receiver_yn = value;
            } else if (type === "play") {
                play = value;
            }

            var receiver_suffix = receiver_yn ? receiver : 'no9';

            //////////////////
            //   RECEIVER   //
            //////////////////
            var fourPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]");
            var fivePlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '5'); select('receiver', this, '+1')\"]");
            var sixPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '6'); select('receiver', this, '+1')\"]");
            // With receiver...
            if (receiver_yn) {
                fourPlusOneButton.disabled = false;
                fivePlusOneButton.disabled = false;
                sixPlusOneButton.disabled = false;
            } else {
            // ...without receiver...
                fourPlusOneButton.disabled = true;
                fivePlusOneButton.disabled = true;
                sixPlusOneButton.disabled = true;
                if (n < 7) {
                    var nButton = document.querySelector(".button[onclick=\"select('n', this, '"+n+"'); select('receiver', this, '')\"]");
                    var nPlusOneButton = document.querySelector(".button[onclick=\"select('n', this, '"+n+"'); select('receiver', this, '+1')\"]");
                    nButton.classList.add("active");
                    nPlusOneButton.classList.remove("active");
                    receiver = 'no9';
                } 
            }

            ////////////////////////////
            // SETUP TEXT DESCRIPTION //
            ////////////////////////////
            if (n > 4) {
                if (setup === "A") {
                    text = "<p><b>Auckland</b> has no walk-in pod to initiate the lineout, and no obvious target. The first movement is the dummy jumper (D) attempting to commit the defensive front pod.</p>";
                } else if (setup === "C") {
                    text = "<p><b>Canterbury</b> has a pod of 3 walking in, showing the defence a potential quick option to the middle. As the pod reaches the line, it splits rapidly to join pods at the front and back. </p>";
                } else if (setup === "H") {
                    text = "<p><b>Highlanders</b> gives nothing away to the defence, everyone but the pillars walking in evenly spaced. The key to this setup is arriving together, at speed, once the hooker is ready .</p>";
                } else if (setup === "W") {
                    text = "<p><b>Waikato</b> leaves multiple gaps in the line for potential jumpers to walk into, without any pre-formed pods, making it easy to adjust positions and change the picture for the defence.</p>";
                }
            } else {
                text = "<p>We set up ready to jump at the back, unless the defence is there to compete.<br>For more info on how to run a 4-man lineout, see the <a href='https://docs.google.com/presentation/d/e/2PACX-1vTFXNZF6oYUyOiHx9ZiSAMTBOGWwpjlxMexXD80f-OeBBY7aykFov2h7hDP01OfNErygiVNbmIn3wRK/pub?start=false&loop=true&delayms=60000&slide=id.g1252df79561_0_84'>Playbook</a></p>";
            }
            document.getElementById("setup-text").innerHTML = text;

            ////////////////////////////
            // THROW TEXT DESCRIPTION //
            ////////////////////////////
            var text = ""
            if (n > 4) {
                if (setup === "A") {
                    if (call === "1") {
                        if (n > 5) {
                            var fpod = n - 3;
                            text = "<p>As the front " + fpod + " players distract the defence with a dummy front jump, the back 3 turn to lift the back jumper after the ball is thrown but before the defence can react.</p>"
                        } else {
                            text = "<p>The front " + fpod + " players distract the defence with a dummy front jump, before the dummy jumper (D) has to rejoin the line to be a front lifter for a pod at the back.</p>"
                        }
                    } else if (call === "2") {
                        text = "<p>As the dummy jumper (D) steps out of the line, the man behind him is already in a quarter squat position as a back lifter. He steps forward into the same spot to jump for the ball.</p>";
                    } else if (call === "3") {
                        text = "<p>As the dummy jumper (D) steps out of the line, the man behind him steps forward into the same spot to dummy jump for the ball and keep attention at the front.</p>";
                    }
                } else if (setup === "C") {
                    if (call === "1") {
                        text = "<p>As the walk-in pod hits the line, one player runs to the front as a decoy, and " + (n === 5 ? "two players run" : "one player runs") + " to a back pod.</p>"
                    } else if (call === "2") {
                        text = "<p>As the walk-in pod hits the line, " + (n === 5 ? "two players run" : "one player runs") + " to the front pod, and one player runs to the back as a decoy.</p>"
                    } else if (call === "3") {
                        if (n === '5') {
                            text = "<p>After splitting to the front and back, there is a <em>dummy</em> jump at the front, the back lifter becomes the jumper in the middle</p>";
                        } else if (n === '6') {
                            text = "<p>After dummy jumps at both C1 and C2, the 3 players who <em>weren't</em> in the walk-in pod form a pod in the middle (C1 and C3 use the same jumper)</p>.";
                        } else {
                            text = "<p>After dummy jumps at both C1 and C2, the two nearest players already facing the middle jumper come forward to lift in the middle.</p>";
                        }
                    }
                } else if (setup === "H") {
                    text ="<p>This is the simplest setup, as it involves the least movement and the fewest people (only the jumper and the lifters either side of him).</p>"
                } else if(setup === "W") {
                    if (n != '6'){
                        text = "<p>" + n + "-man Waikato is very similar to Highlanders, except the movement is focused on the jumpers, with the lifters already in place, showing the defence a different picture.</p>";
                    } else {
                        text = "<p>The 6-man variant of Waikato can create the impression of a walk-in pod of 3 together, or spaced out to suit the call.</p>";
                    }
                }
            } else {
                text = "<p>Ideally we want hot ball at the back, but cold ball has to be in the front or middle, closer to the hooker.<br>For more info on how to run a 4-man lineout, see the <a href='https://docs.google.com/presentation/d/e/2PACX-1vTFXNZF6oYUyOiHx9ZiSAMTBOGWwpjlxMexXD80f-OeBBY7aykFov2h7hDP01OfNErygiVNbmIn3wRK/pub?start=false&loop=true&delayms=60000&slide=id.g1252df79561_0_84'>Playbook</a></p>";
            }
            document.getElementById("throw-text").innerHTML = text;

            ///////////////////////////
            // PLAY TEXT DESCRIPTION //
            ///////////////////////////
            var text = ""
            if (n > 4){
                if (play === "Hot") {
                    text = "<p>This is the default play off the top of the lineout to the scrum half. The half backs really don't want front ball at the lineout ("+ setup + call +") because it puts more pressure on longer passes.</p>";
                } else if (play === "Crusaders") {
                    text = "<p><b>Crusaders</b> is a play that initiates a maul, but leaves forward options on one or both sides to carry into the space vacated by defenders joining the maul.</p>";
                } else if (play === "Flyby") {
                    text = "<p><b>Flyby</b> is a play that initiates a maul, but while the maul is being formed, a player peels around the corner into the space vacated by defenders joining the maul.</p>";
                } else if (play === "Cold") {
                    text = "<p>With or without a scrum half, any lineout can form a maul. The nearest forward to the jumping pod will be first over the ball to initiate the maul, before others join to form a long, narrow formation.</p>";
                }
            } else {
                if (play === "Hot") {
                    text = "<p>At the back, the ball can be fed to a pod of forwards or to the 10 for a strike move.</p>";
                } else if (play === "Cold") {
                    text = "<p>Teams generally don't expect a 4-man maul, so breaking the gain line provides a good setup for <b>England</b>, or to launch a backs move while the defence is resetting.</p>";
                }
            }
            document.getElementById("play-text").innerHTML = text;

            ///////////////////////////
            //      LOAD CHARTS      //
            ///////////////////////////
            var url_root = "https://raw.githubusercontent.com/samnlindsay/RugbyResults/master/json";

            var default_play = (receiver === "" ? "Hot" : "Cold");
            var throw_play = (play === null ? default_play : (play === 'Hot' ? 'Hot' : 'Cold'));
            if (n > 4) {
                var spec1 = url_root + "/setup_" + n + receiver_suffix + "_" + setup + ".json";            
                var spec2 = url_root + "/throw_" + n + receiver_suffix + "_" + setup + call + "_" + throw_play + ".json";
                var spec3 = url_root + "/play_" + n + receiver_suffix + "_" + setup + call + '_' + play + ".json";
            } else {
                var spec1 = url_root + "/setup_" + n + receiver_suffix + ".json";
                var spec2 = url_root + "/throw_" + n + receiver_suffix + ".json";
                var spec3 = url_root + "/play_" + n + receiver_suffix + ".json";
            }
            
            if (n !== null && setup !== null) {
                document.getElementsByClassName("container")[0].style.display = "flex";
                document.getElementById("diagram-title").style.display = "flex";

                vegaEmbed("#setup-chart", spec1, { actions: false }).catch(console.error);

                if (call !== null){
                    vegaEmbed("#throw-chart", spec2, { actions: false }).catch(console.error);
                    if (play !== null) {
                        vegaEmbed("#play-chart", spec3, { actions: false }).catch(console.error);
                    } else {
                        document.getElementById("play-text").innerHTML = "";
                        document.getElementById("play-chart").innerHTML = "";
                    }
                } else {
                    document.getElementById("throw-text").innerHTML = "";
                    document.getElementById("throw-chart").innerHTML = "";
                }
            } else {
                document.getElementById("setup-text").innerHTML = "";
                document.getElementById("setup-chart").innerHTML = "";
            }

            ///////////////////////
            // CALL TEXT SUMMARY //
            ///////////////////////
            if (n != null && setup != null && call != null) {
                var numbers = n + (receiver === '+1' ? receiver : '-man');
                var fullcall = setup + call + (play === null ? '' : (' ' + play));
            
                document.getElementById("fullCallText").innerHTML = '\"' + numbers + ' ' + (n>4 ? fullcall : play) + '\"';

                var backsText = '<ul style="list-style - position: inside;">';

                var fwds_in_backline = (7 - n - (receiver === '+1' ? 1 : 0));
                var numbers_text = "<span style='color:red; font-weight:bold;'>" + (fwds_in_backline > 0 ? fwds_in_backline : "No") + " forward" + (fwds_in_backline != 1 ? "s" : "") + (receiver!="" ? " (+ scrum half)" : "") + "</span> " + (fwds_in_backline != 1 ? "are" : "is") + " in the backline";

                if (play != null) {
                    var play_text = {
                        "Hot": "The ball is coming <span style='color:red; font-weight:bold;'>straight to the backs...</span>",
                        "Cold": "<span style='color:hsl(225, 100%, 20%); font-weight:bold;'>The forwards are mauling</span>",
                        "Crusaders": "<span style='color:hsl(225, 100%, 20%); font-weight:bold;'>The forwards are mauling</span> or carrying",
                        "Flyby": "The hooker is carrying round the corner",
                    };
                    backsText += "<li>" + play_text[play] + "</li>";
                }

                if (play === "Hot"){
                    var call_text = {
                        "1": "...from the <span style='color:red; font-weight:bold;'>back</span> of the lineout",
                        "2": "...from the <span style='color:red; font-weight:bold;'>front</span> of the lineout",
                        "3": "...from the <span style='color:red; font-weight:bold;'>middle</span> of the lineout",
                    }
                    backsText += "<li>" + call_text[call] + "</li>";
                }
                backsText += "<li>" + numbers_text + "</li>";
                
                document.getElementById("backsText").innerHTML = backsText + "</ul>"

                document.getElementById("call-summary").style.display = "flex";
            }

            if (n === '4') {
                document.querySelectorAll(".button[onclick^=\"select('setup', this\"]").forEach(button => {button.disabled = true;});
                document.querySelectorAll(".button[onclick^=\"select('call', this\"]").forEach(button => {button.disabled = true;});
                // Remove active class from Setup buttons
                var buttons = document.querySelectorAll('.button[onclick^="select(\'setup\', this"]');
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].classList.remove("active");
                }
                // Remove active class from Call buttons
                var buttons = document.querySelectorAll('.button[onclick^="select(\'call\', this"]');
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].classList.remove("active");
                }

                if (receiver === '+1') {
                    document.querySelectorAll(".button[onclick^=\"select('play', this\"]").forEach(button => { button.disabled = false; });
                    document.querySelector(".button[onclick=\"select('play', this, 'Cold')\"]").click();
                    document.querySelector(".button[onclick=\"select('play', this, 'Hot')\"]").disabled = true;
                } else {
                    document.querySelectorAll(".button[onclick^=\"select('play', this\"]").forEach(button => { button.disabled = false; });
                    document.querySelector(".button[onclick=\"select('play', this, 'Hot')\"]").click();
                    document.querySelector(".button[onclick=\"select('play', this, 'Cold')\"]").disabled = true;
                }
                document.querySelector(".button[onclick=\"select('play', this, 'Flyby')\"]").disabled = true;
                document.querySelector(".button[onclick=\"select('play', this, 'Crusaders')\"]").disabled = true;
                
            } else {
                document.querySelectorAll(".button[onclick^=\"select('setup', this\"]").forEach(button => { button.disabled = false; });
                document.querySelectorAll(".button[onclick^=\"select('call', this\"]").forEach(button => { button.disabled = false; });
                document.querySelectorAll(".button[onclick^=\"select('play', this\"]").forEach(button => { button.disabled = false; });

                // // If no setup buttons are active, click Canterbury
                // if (!document.querySelector(".button[onclick^=\"select('setup', this\"]").classList.contains("active")) {
                //     document.querySelector(".button[onclick=\"select('setup', this, 'C')\"]").click();
                // }

                // // If no call buttons are active, click 1
                // if (!document.querySelector(".button[onclick^=\"select('call', this\"]").classList.contains("active")) {
                //     if (play === "Hot") {
                //         document.querySelector(".button[onclick=\"select('call', this, '1')\"]").click();
                //     } else {
                //         document.querySelector(".button[onclick=\"select('call', this, '3')\"]").click();
                //     }
                // }
            }
        }

        // ////////////////////////////////////
        // // TEMPORARY - BUTTONS TO DISABLE //
        // ////////////////////////////////////

        // // Disable 4/4+1 buttons
        // document.querySelector(".button[onclick=\"select('n', this, '4'); select('receiver', this, '+1')\"]").disabled = true;
        // document.querySelector(".button[onclick=\"select('n', this, '4'); select('receiver', this, '')\"]").disabled = true;

        function openTab(evt, tabName) {
            var i, tabcontent, row-button;
            tabcontent = document.getElementsByClassName("chart-container");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            row-button = document.getElementsByClassName("row-button");
            for (i = 0; i < row-button.length; i++) {
                row-button[i].className = row-button[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

    </script>
    
</body>

</html>